<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="goquery"><meta name="keywords" content><meta name="author" content="Smiley"><meta name="copyright" content="Smiley"><title>goquery | Smiley</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Goquery"><span class="toc-number">1.</span> <span class="toc-text">Goquery</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#概述"><span class="toc-number">1.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装"><span class="toc-number">1.2.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example"><span class="toc-number">1.3.</span> <span class="toc-text">Example</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#goquery主要类型"><span class="toc-number">1.4.</span> <span class="toc-text">goquery主要类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Document"><span class="toc-number">1.4.1.</span> <span class="toc-text">Document</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#func-NewDocumentFromReader"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">func NewDocumentFromReader</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Matcher"><span class="toc-number">1.4.2.</span> <span class="toc-text">Matcher</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Selection"><span class="toc-number">1.4.3.</span> <span class="toc-text">Selection</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#选择器"><span class="toc-number">1.5.</span> <span class="toc-text">选择器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#基于HTML-Element元素"><span class="toc-number">1.5.1.</span> <span class="toc-text">基于HTML Element元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ID选择器"><span class="toc-number">1.5.2.</span> <span class="toc-text">ID选择器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Element-ID选择器"><span class="toc-number">1.5.3.</span> <span class="toc-text">Element ID选择器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Class选择器"><span class="toc-number">1.5.4.</span> <span class="toc-text">Class选择器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Element-Class选择器"><span class="toc-number">1.5.5.</span> <span class="toc-text">Element Class选择器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#属性选择器"><span class="toc-number">1.5.6.</span> <span class="toc-text">属性选择器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#parent-gt-child选择器"><span class="toc-number">1.5.7.</span> <span class="toc-text">parent&gt;child选择器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#prev-next相邻选择器"><span class="toc-number">1.5.8.</span> <span class="toc-text">prev+next相邻选择器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#prev-next选择器"><span class="toc-number">1.5.9.</span> <span class="toc-text">prev~next选择器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#内容过滤器"><span class="toc-number">1.5.10.</span> <span class="toc-text">内容过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#first-child过滤器"><span class="toc-number">1.5.11.</span> <span class="toc-text">:first-child过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#first-of-type过滤器"><span class="toc-number">1.5.12.</span> <span class="toc-text">:first-of-type过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nth-child-n-过滤器"><span class="toc-number">1.5.13.</span> <span class="toc-text">:nth-child(n) 过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nth-of-type-n-过滤器"><span class="toc-number">1.5.14.</span> <span class="toc-text">:nth-of-type(n) 过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#only-child-过滤器"><span class="toc-number">1.5.15.</span> <span class="toc-text">:only-child 过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#only-of-type-过滤器"><span class="toc-number">1.5.16.</span> <span class="toc-text">:only-of-type 过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#选择器或-运算"><span class="toc-number">1.5.17.</span> <span class="toc-text">选择器或(|)运算</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#goquery实战"><span class="toc-number">1.6.</span> <span class="toc-text">goquery实战</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://cn.bing.com/th?id=OIP.GGMMu1oe3Cqby3tKJJ6DcgHaHW&amp;pid=Api&amp;rs=1"></div><div class="author-info__name text-center">Smiley</div><div class="author-info__description text-center">Personal Blog</div><div class="follow-button"><a href="https://github.com/Wsmiley">Follw Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">10</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">2</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(http://img18.3lian.com/d/file/201709/14/fbf49f60bc1912277ca0aa46db1499e0.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Smiley</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="post-info"><div id="post-title">goquery</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-07-26</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="Goquery"><a href="#Goquery" class="headerlink" title="Goquery"></a>Goquery</h1><blockquote>
<p><a href="https://github.com/PuerkitoBio/goquery" target="_blank" rel="noopener">https://github.com/PuerkitoBio/goquery</a></p>
</blockquote>
<blockquote>
<p><a href="https://godoc.org/github.com/PuerkitoBio/goquery" target="_blank" rel="noopener">https://godoc.org/github.com/PuerkitoBio/goquery</a></p>
</blockquote>
<hr>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>goquery是go语言的HTML解析库。基于Go的net/http包和CSS选择器库cascadia，实现了类似jQuery的功能，包括链式操作语法、操作和查询HTML文档。因为net/html解析器需要UTF-8编码，goquery也是如此；调用者要确保提供UTF-8编码的HTML。</p>
<hr>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">$ <span class="keyword">go</span> get github.com/PuerkitoBio/goquery</span><br></pre></td></tr></table></figure>

<h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"log"</span></span><br><span class="line">  <span class="string">"net/http"</span></span><br><span class="line"></span><br><span class="line">  <span class="string">"github.com/PuerkitoBio/goquery"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ExampleScrape</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// Request the HTML page.</span></span><br><span class="line">  res, err := http.Get(<span class="string">"http://metalsucks.net"</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    log.Fatal(err)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">defer</span> res.Body.Close()</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> res.StatusCode != <span class="number">200</span> &#123;</span><br><span class="line">    log.Fatalf(<span class="string">"status code error: %d %s"</span>, res.StatusCode, res.Status)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Load the HTML document</span></span><br><span class="line">  doc, err := goquery.NewDocumentFromReader(res.Body)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    log.Fatal(err)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Find the review items</span></span><br><span class="line">  doc.Find(<span class="string">".sidebar-reviews article .content-block"</span>).Each(<span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>, s *goquery.Selection)</span></span> &#123;</span><br><span class="line">    <span class="comment">// For each item found, get the band and title</span></span><br><span class="line">    band := s.Find(<span class="string">"a"</span>).Text()</span><br><span class="line">    title := s.Find(<span class="string">"i"</span>).Text()</span><br><span class="line">    fmt.Printf(<span class="string">"Review %d: %s - %s\n"</span>, i, band, title)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  ExampleScrape()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="goquery主要类型"><a href="#goquery主要类型" class="headerlink" title="goquery主要类型"></a>goquery主要类型</h2><h3 id="Document"><a href="#Document" class="headerlink" title="Document"></a>Document</h3><p>Document 代表一个将要被操作的HTML文档。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Document <span class="keyword">struct</span> &#123;</span><br><span class="line">    *Selection</span><br><span class="line">    Url *url.URL</span><br><span class="line">    <span class="comment">// contains filtered or unexported fields</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Document 可以通过.Find()方法获取一个Selection实列</p>
</blockquote>
<h4 id="func-NewDocumentFromReader"><a href="#func-NewDocumentFromReader" class="headerlink" title="func NewDocumentFromReader"></a>func NewDocumentFromReader</h4><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewDocumentFromReader</span><span class="params">(r io.Reader)</span> <span class="params">(*Document, error)</span></span></span><br></pre></td></tr></table></figure>

<p>NewDocumentFromReader从io.Reader返回一个文档。如果无法将阅读器的数据解析为html，则返回一个错误作为第二个值。</p>
<h3 id="Matcher"><a href="#Matcher" class="headerlink" title="Matcher"></a>Matcher</h3><p>Matcher是一个接口，它定义了将HTML节点与编译后的选择器字符串匹配的方法。Cascadia的选择器实现了这个接口。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Matcher <span class="keyword">interface</span> &#123;</span><br><span class="line">    Match(*html.Node) <span class="keyword">bool</span></span><br><span class="line">    MatchAll(*html.Node) []*html.Node</span><br><span class="line">    Filter([]*html.Node) []*html.Node</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Selection"><a href="#Selection" class="headerlink" title="Selection"></a>Selection</h3><p>Selection代表符合特定条件的节点集合</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Selection <span class="keyword">struct</span> &#123;</span><br><span class="line">    Nodes []*html.Node</span><br><span class="line">    <span class="comment">// contains filtered or unexported fields</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Selection类型主要提供以下方法:<br><strong>类似函数位置操作</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">– Eq()</span><br><span class="line">– First()</span><br><span class="line">– Get()</span><br><span class="line">– Index…() <span class="comment">//...表示重载</span></span><br><span class="line">– Last()</span><br><span class="line">– Slice()</span><br></pre></td></tr></table></figure>

<p><strong>过滤方法，减少节点集合</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">– End()</span><br><span class="line">– Filter…()</span><br><span class="line">– Has…()</span><br><span class="line">– Not…()</span><br></pre></td></tr></table></figure>

<p><strong>循环遍历选择节点</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">– Each()</span><br><span class="line">– EachWithBreak()</span><br><span class="line">– Map()</span><br></pre></td></tr></table></figure>

<p><strong>检测或获取节点属性值</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">– Attr(), RemoveAttr(), SetAttr()</span><br><span class="line">– Html()</span><br><span class="line">– Length()</span><br><span class="line">– Size()</span><br><span class="line">– Text()</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="选择器"><a href="#选择器" class="headerlink" title="选择器"></a>选择器</h2><p>基于CSS选择器,把HTTP服务器返回的HTML文本筛选出所需要的节点</p>
<h3 id="基于HTML-Element元素"><a href="#基于HTML-Element元素" class="headerlink" title="基于HTML Element元素"></a>基于HTML Element元素</h3><p>HTML标签元素</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">dom.Find(<span class="string">"div"</span>).Each(<span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>, selection *goquery.Selection)</span></span> &#123;</span><br><span class="line">      fmt.Println(selection.Text())</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="ID选择器"><a href="#ID选择器" class="headerlink" title="ID选择器"></a>ID选择器</h3><p>当两个相同的元素,例如有两个div元素,但只需要其中一个div。#代表筛选ID</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">dom.Find(<span class="string">"#div1"</span>).Each(<span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>, selection *goquery.Selection)</span></span> &#123;</span><br><span class="line">    fmt.Println(selection.Text())</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="Element-ID选择器"><a href="#Element-ID选择器" class="headerlink" title="Element ID选择器"></a>Element ID选择器</h3><p>拥有相同ID,但是分别属于不同的HTML元素。Find(“element#id”)</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">dom.Find(<span class="string">"div#div1"</span>).Each(<span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>, selection *goquery.Selection)</span></span> &#123;</span><br><span class="line">    fmt.Println(selection.Text())</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="Class选择器"><a href="#Class选择器" class="headerlink" title="Class选择器"></a>Class选择器</h3><p>与ID选择器类似。用 . 表示</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">dom.Find(<span class="string">".name"</span>).Each(<span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>, selection *goquery.Selection)</span></span> &#123;</span><br><span class="line">    fmt.Println(selection.Text())</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="Element-Class选择器"><a href="#Element-Class选择器" class="headerlink" title="Element Class选择器"></a>Element Class选择器</h3><p>与上面Element ID选择器类似。Find(“element.class”) 筛选element、并且指定class的元素</p>
<h3 id="属性选择器"><a href="#属性选择器" class="headerlink" title="属性选择器"></a>属性选择器</h3><p>通过属性来筛选元素。Find(“elemet[Attributes]”)。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">dom.Find(<span class="string">"div[class]"</span>).Each(<span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>, selection *goquery.Selection)</span></span> &#123;</span><br><span class="line">    fmt.Println(selection.Text())</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>通过值来筛选元素。Find[“element[Attributes=value”]]</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">dom.Find(<span class="string">"div[class=name]"</span>).Each(<span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>, selection *goquery.Selection)</span></span> &#123;</span><br><span class="line">     fmt.Println(selection.Text())</span><br><span class="line"> &#125;)</span><br></pre></td></tr></table></figure>

<p>筛选属性值不等于该值Find(“element[Attributes!=value]”)</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">dom.Find(<span class="string">"div[lang!=zh]"</span>).Each(<span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>, selection *goquery.Selection)</span></span> &#123;</span><br><span class="line">     fmt.Println(selection.Text())</span><br><span class="line"> &#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li>Find(“div[lang¦=zh]”)筛选lang属性为zh或者zh-开头的div元素</li>
<li>Find(“div[lang*=zh]”)筛选lang属性包含zh这个字符串的div元素</li>
<li>Find(“div[lang^=zh]”)筛选lang属性以zh开头的div元素，区分大小写</li>
<li>Find(“div[lang$=zh]”)筛选lang属性以zh结尾的div元素，区分大小写</li>
<li>Find(“div[lang~=zh]”)筛选lang属性包含zh这个单词的div元素，单词以空格分开的</li>
</ul>
<p>多个属性筛选器组合使用</p>
<ul>
<li>Find(“div[id][lang=zh]”)用多个中括号连起来即可。当有多个属性筛选器的时候，要同时满足这些筛选器的元素才能被筛选出来。</li>
</ul>
<h3 id="parent-gt-child选择器"><a href="#parent-gt-child选择器" class="headerlink" title="parent&gt;child选择器"></a>parent&gt;child选择器</h3><p>筛选出某个元素下符合条件的子元素。Find(“parent&gt;child”)</p>
<p>表示筛选parent这个父元素下，符合child这个条件的最直接（一级）的子元素。</p>
<h3 id="prev-next相邻选择器"><a href="#prev-next相邻选择器" class="headerlink" title="prev+next相邻选择器"></a>prev+next相邻选择器</h3><p>要筛选的元素没有规律，但是该元素的上一个元素有规律。Find(“prev+next”)</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">dom.Find(<span class="string">"div[lang=zh]+p"</span>).Each(<span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>, selection *goquery.Selection)</span></span> &#123;</span><br><span class="line">    fmt.Println(selection.Text())</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="prev-next选择器"><a href="#prev-next选择器" class="headerlink" title="prev~next选择器"></a>prev~next选择器</h3><p>共有一个父元素。Find(“prev~next”)</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">dom.Find(<span class="string">"div[lang=zh]~p"</span>).Each(<span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>, selection *goquery.Selection)</span></span> &#123;</span><br><span class="line">     fmt.Println(selection.Text())</span><br><span class="line"> &#125;)</span><br></pre></td></tr></table></figure>

<h3 id="内容过滤器"><a href="#内容过滤器" class="headerlink" title="内容过滤器"></a>内容过滤器</h3><p>Find(“:contains(text)”)表示筛选出的元素要包含指定的文本,Find(“:empty”)表示筛选出的元素都不能有子元素（包括文本元素）</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">dom.Find(<span class="string">"div:contains(DIV2)"</span>).Each(<span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>, selection *goquery.Selection)</span></span> &#123;</span><br><span class="line">     fmt.Println(selection.Text())</span><br><span class="line"> &#125;)</span><br></pre></td></tr></table></figure>

<h3 id="first-child过滤器"><a href="#first-child过滤器" class="headerlink" title=":first-child过滤器"></a>:first-child过滤器</h3><p>Find(“:first-child”)，表示筛选出的元素要是他们的父元素的第一个子元素，如果不是，则不会被筛选出来。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">dom.Find(<span class="string">"div:first-child"</span>).Each(<span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>, selection *goquery.Selection)</span></span> &#123;</span><br><span class="line">    fmt.Println(selection.Html())</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="first-of-type过滤器"><a href="#first-of-type过滤器" class="headerlink" title=":first-of-type过滤器"></a>:first-of-type过滤器</h3><p>只要是这个类型的第一个就可以</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">dom.Find(<span class="string">"div:first-of-type"</span>).Each(<span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>, selection *goquery.Selection)</span></span> &#123;</span><br><span class="line">    fmt.Println(selection.Html())</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>:last-child 和 :last-of-type过滤器与上面两个过滤器正好相反</strong></p>
</blockquote>
<h3 id="nth-child-n-过滤器"><a href="#nth-child-n-过滤器" class="headerlink" title=":nth-child(n) 过滤器"></a>:nth-child(n) 过滤器</h3><p>筛选出的元素是其父元素的第n个元素，n以1开始</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">dom.Find(<span class="string">"div:nth-child(3)"</span>).Each(<span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>, selection *goquery.Selection)</span></span> &#123;</span><br><span class="line">    fmt.Println(selection.Html())</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="nth-of-type-n-过滤器"><a href="#nth-of-type-n-过滤器" class="headerlink" title=":nth-of-type(n) 过滤器"></a>:nth-of-type(n) 过滤器</h3><p>表示的是同类型元素的第n个。</p>
<blockquote>
<p>nth-last-child(n) 和:nth-last-of-type(n)过滤器与上面两个过滤器正好相反</p>
</blockquote>
<h3 id="only-child-过滤器"><a href="#only-child-过滤器" class="headerlink" title=":only-child 过滤器"></a>:only-child 过滤器</h3><p>表示筛选的元素，在其父元素中，只有它自己，它的父元素没有其他子元素，才会被匹配筛选出来。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">dom.Find(<span class="string">"div:only-child"</span>).Each(<span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>, selection *goquery.Selection)</span></span> &#123;</span><br><span class="line">    fmt.Println(selection.Html())</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="only-of-type-过滤器"><a href="#only-of-type-过滤器" class="headerlink" title=":only-of-type 过滤器"></a>:only-of-type 过滤器</h3><p>Find(“:only-of-type”)。同类型元素只要只有一个，就可以被筛选出来</p>
<h3 id="选择器或-运算"><a href="#选择器或-运算" class="headerlink" title="选择器或(|)运算"></a>选择器或(|)运算</h3><p>同时筛选出不同元素时可以采用多个选择器进行组合使用并以逗号(,)分割。使用Find(“selector1, selector2, selectorN”)。只要满足其中一个选择器就可以被筛选出来，也就是选择器的或(|)运算操作。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">dom.Find(<span class="string">"div,span"</span>).Each(<span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>, selection *goquery.Selection)</span></span> &#123;</span><br><span class="line">    fmt.Println(selection.Html())</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a href="http://www.w3school.com.cn/cssref/css_selectors.asp" target="_blank" rel="noopener">http://www.w3school.com.cn/cssref/css_selectors.asp</a></p>
</blockquote>
<blockquote>
<p><a href="https://zhuanlan.zhihu.com/p/33122909?from_voters_page=true" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/33122909?from_voters_page=true</a> </p>
</blockquote>
<hr>
<h2 id="goquery实战"><a href="#goquery实战" class="headerlink" title="goquery实战"></a>goquery实战</h2><p>简单爬取豆瓣书籍数据</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">	<span class="string">"strconv"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"github.com/PuerkitoBio/goquery"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ExampleScrape</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Request the HTML page.</span></span><br><span class="line">	res, err := http.Get(<span class="string">"https://book.douban.com/tag/%E4%BA%92%E8%81%94%E7%BD%91"</span>)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt;= <span class="number">100</span>; i += <span class="number">20</span> &#123;</span><br><span class="line">		str := <span class="string">"https://book.douban.com/tag/%E4%BA%92%E8%81%94%E7%BD%91?start="</span> + strconv.Itoa(i) + <span class="string">"&amp;type=T"</span></span><br><span class="line">		<span class="keyword">if</span> i != <span class="number">0</span> &#123;</span><br><span class="line">			res, err = http.Get(str)</span><br><span class="line">		&#125;</span><br><span class="line">		fmt.Println(str)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Fatal(err)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">defer</span> res.Body.Close()</span><br><span class="line">		<span class="keyword">if</span> res.StatusCode != <span class="number">200</span> &#123;</span><br><span class="line">			log.Fatalf(<span class="string">"status code error: %d %s"</span>, res.StatusCode, res.Status)</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Load the HTML document</span></span><br><span class="line">		doc, err := goquery.NewDocumentFromReader(res.Body)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Fatal(err)</span><br><span class="line">		&#125;</span><br><span class="line">		doc.Find(<span class="string">"#subject_list .info"</span>).Each(<span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>, s *goquery.Selection)</span></span> &#123;</span><br><span class="line">			<span class="comment">// For each item found, get the band and title</span></span><br><span class="line">			band := s.Find(<span class="string">".pub"</span>).Text()</span><br><span class="line">			name, _ := s.Find(<span class="string">"a"</span>).Attr(<span class="string">"title"</span>)</span><br><span class="line">			fmt.Printf(<span class="string">"Review %d: %s -%s\n"</span>, i, name, band)</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	ExampleScrape()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="//wsmiley.github.io/2019/07/26/goquery/%E8%B1%86%E7%93%A3%E4%B9%A6%E7%B1%8D%E6%95%B0%E6%8D%AE.png" alt="豆瓣书籍数据"></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Smiley</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://wsmiley.github.io/2019/07/26/goquery/">http://wsmiley.github.io/2019/07/26/goquery/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://wsmiley.github.io">Smiley</a>！</span></div></div><div class="post-meta__tag-list"></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2019/07/31/初识Docker/"><i class="fa fa-chevron-left">  </i><span>初识Docker</span></a></div><div class="next-post pull-right"><a href="/2019/07/21/golang随记/"><span>golang随记</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(http://img18.3lian.com/d/file/201709/14/fbf49f60bc1912277ca0aa46db1499e0.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2019 By Smiley</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">Hi, welcome to my blog</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script></body></html>